- name: Create ansible user
  user:
    name: "{{ user_name }}"
    password: "{{ user_password | password_hash('sha512', user_password_salt) }}"
    shell: /bin/bash
    home: "/home/{{ user_name }}"
    create_home: true
    group: "{{ user_group }}"
    groups:
      - sudo
    state: present

- name: Inject ansible SSH key
  authorized_key:
    user: ansible
    state: present
    key: "{{ lookup('file', 'ansible.pub') }}"
    exclusive: yes

- name: Add sudoers file for ansible
  copy:
    src: sudoer_ansible
    dest: "/etc/sudoers.d/ansible"
    owner: root
    group: root
    mode: 0440